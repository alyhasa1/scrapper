# 2025-11-05

- Updated `ebay_stock_scraper.py` fallback so STATUS writes default to column I when header lookup fails.
- Authored `scraper_setup_guide.md` documenting environment setup, dependencies, and usage flow for sharing externally.
- Normalized `stock_name` assignment in `load_variants_from_excel` so CLI runs with blank product cells no longer hit `'float' object has no attribute split`.
- **CRITICAL FIX #1**: Enhanced `option_matches()` to handle different seller naming conventions:
  - Added `extract_base_colour()` to strip seller-specific suffixes (e.g., "Silver Black - Greekey" → "silver black", "Silver - Gel Back 59" → "silver")
  - Added `extract_base_size()` to remove imperial measurements from sizes (e.g., "40 x 60 cm (1 ft 4 in x 2 ft)" → "40 x 60 cm")
  - This fixes matching failures when scraping listings from different sellers with different naming formats.
- **CRITICAL FIX #2**: Made variant selection order-agnostic:
  - Some listings have Colour first (group 0) and Size second (group 1), e.g., listing 364946395670
  - Other listings have Size first (group 0) and Colour second (group 1), e.g., listing 363486576357
  - Scraper now dynamically detects group order and processes dimensions in page order
  - Fixes errors when trying to select variants on listings with different group ordering
- **CRITICAL FIX #3**: Fixed dropdown option visibility and clicking issues:
  - Added `scroll_into_view_if_needed()` before clicking dropdown options to ensure they're visible
  - Added explicit `wait_for(state="visible")` with 3s timeout before clicking
  - Increased click timeout to 10s and added better error handling
  - Added comprehensive debug logging to `option_matches()` to trace matching logic
  - Improved size matching to handle spacing variations (e.g., "60x110" vs "60 x 110")
- **CRITICAL FIX #4**: Enhanced size matching to strip units and normalize spacing:
  - Excel sheets often have sizes like "80x150" (no spaces, no units)
  - eBay shows sizes like "80 x 150 cm" (with spaces and units)
  - Updated `extract_base_size()` to strip "cm", "mm", "m" units
  - Updated `option_matches()` to always compare space-normalized versions
  - Now correctly matches "80x150" ↔ "80 x 150 cm", "40x60" ↔ "40 x 60 cm"
